---
title: "socatã§LSPã‚’ã¿ã¦ã¿ã‚‹"
emoji: "ğŸ‘â€ğŸ—¨"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["lsp", "Neovim"]
published: true
---

sshè¶Šã—ã«`xdg-open`ã§ããªã„ã‹ãªã‚ã¨ã‹ã‚’èª¿ã¹ã¦ãŸã‚‰[socat](http://www.dest-unreach.org/socat/)ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’çŸ¥ã‚Šã¾ã—ãŸã€‚
TCPã¨ã‹UNIXã‚½ã‚±ãƒƒãƒˆã¨ã‹ãƒ•ã‚¡ã‚¤ãƒ«ãªã©ã®é–“ã®åŒæ–¹å‘ã®é€šä¿¡ã‚’ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã‚‰ã—ã„ã§ã™ã€‚
ã“ã‚Œã‚’ä½¿ãˆã°æ¨™æº–å…¥å‡ºåŠ›ã§ã‚„ã‚Šå–ã‚Šã™ã‚‹ã‚¿ã‚¤ãƒ—ã®è¨€èªã‚µãƒ¼ãƒãƒ¼ã®ç”Ÿã®ã‚„ã‚Šå–ã‚Šã‚’çœºã‚ã‚‹ã“ã¨ãŒã§ããã†ã ã£ãŸã®ã§ã€ã‚„ã£ã¦ã¿ã¾ã—ãŸ[^1]ã€‚

[^1]: åˆ¥ã«TCPä½¿ã£ã¦ã¦ã‚‚ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚

# ã‚„ã£ã¦ã¿ã‚‹

[Man](http://www.dest-unreach.org/socat/doc/socat.html)ã®[Examples](http://www.dest-unreach.org/socat/doc/socat.html#EXAMPLES)ã‚’ã¿ã¦ã‚‹ã¨ãªã‚“ã¨ãªãä½¿ã„æ–¹ãŒã‚ã‹ã‚Šã¾ã™ã€‚

ä»Šå›ã¯æ¨™æº–å…¥å‡ºåŠ›ã§ã‚„ã‚Šå–ã‚Šã™ã‚‹è¨€èªã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ã„ã¾ã™[^2]ã€‚
ãªã®ã§ã€`socat`ã§ã¯`socat`ã®æ¨™æº–å…¥å‡ºåŠ›(`-`)ã¨è¨€èªã‚µãƒ¼ãƒãƒ¼ã®ãƒ—ãƒ­ã‚»ã‚¹(`EXEC`)ã‚’ä½¿ã„ã¾ã™ã€‚
ãã‚Œã§åŒæ–¹å‘ã®ã‚„ã‚Šå–ã‚Šã‚’`-r`ãŠã‚ˆã³`-R`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã£ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ€ãƒ³ãƒ—ã—ã¾ã™ã€‚
ãªã®ã§ã€ä¾‹ãˆã°`rust-anlyzer`ã®ã‚„ã‚Šå–ã‚Šã‚’ã¿ãŸã‘ã‚Œã°ã€`rust-anlyzer`ã®ä»£ã‚ã‚Šã«

```
socat -r messages_from_client.txt -R messages_from_server.txt - EXEC:rust-anlyzer
```

ã‚’å®Ÿè¡Œã™ã‚Œã°ã€`messages_from_server.txt`ã¨`messages_from_client.txt`ã«JSONRPCã®ç”Ÿãƒ‡ãƒ¼ã‚¿ãŒæ®‹ã‚Šã¾ã™ã€‚

[^2]: è‡ªåˆ†ãŒè©¦ã—ãŸã®ã¯ã€lua-language-serverã€rust-anlyzerã€jetlsã§ã™ã€‚

è¨€èªã‚µãƒ¼ãƒãƒ¼ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®è¨­å®šã«åæ˜ ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€ä»Šå›ã¯Neovimã‚’ä½¿ã£ã¦ã‚„ã‚‹ã®ã§ã€

```lua: after/lsp/lua-language-server.lua
return {
    cmd = { 'socat', '-r', log_file_from_client, '-R', log_file_from_server, '-', 'EXEC:' .. 'lua-language-server' },
}
```

ã®ã‚ˆã†ãªã‚‚ã®ã‚’æ›¸ã‘ã°ã€ã“ã‚“ãªæ„Ÿã˜ã®ã‚‚ã®ãŒè¦‹ã‚Œã¾ã™:

```json: client â†’ server
Content-Length: 4311

{"params":{"rootUri":"file:///home/qwjyh/dotfiles","rootPath":"/home/qwjyh/dotfiles","clientInfo":{"version":"0.11.5+v0.11.5","name":"Neovim"},"trace":"off","workDoneToken":"1","workspaceFolders":[{"name":"/home/qwjyh/dotfiles","uri":"file:///home/qwjyh/dotfiles"}],"processId":540974,"capabilities":{"general":{"positionEncodings":["utf-8","utf-16","utf-32"]},"workspace":{"didChangeWatchedFiles":{"relativePatternSupport":true,"dynamicRegistration":false},"workspaceEdit":{"resourceOperations":["rename","create","delete"]},"didChangeConfiguration":{"dynamicRegistration":false},"workspaceFolders":true,"configuration":true,"semanticTokens":{"refreshSupport":true},"inlayHint":{"refreshSupport":true},"applyEdit":true,"symbol":{"symbolKind":{"valueSet":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]},"dynamicRegistration":false}},"textDocument":{"diagnostic":{"dynamicRegistration":false,"tagSupport":{"valueSet":[1,2]}},"definition":{"linkSupport":true,"dynamicRegistration":true},"declaration":{"linkSupport":true},"references":{"dynamicRegistration":false},"synchronization":{"willSaveWaitUntil":true,"dynamicRegistration":false,"didSave":true,"willSave":true},"semanticTokens":{"serverCancelSupport":false,"multilineTokenSupport":false,"overlappingTokenSupport":true,"tokenTypes":["namespace","type","class","enum","interface","struct","typeParameter","parameter","variable","property","enumMember","event","function","method","macro","keyword","modifier","comment","string","number","regexp","operator","decorator"],"requests":{"range":false,"full":{"delta":true}},"formats":["relative"],"tokenModifiers":["declaration","definition","readonly","static","deprecated","abstract","async","modification","documentation","defaultLibrary"],"dynamicRegistration":false,"augmentsSyntaxTokens":true},"inlayHint":{"resolveSupport":{"properties":["textEdits","tooltip","location","command"]},"dynamicRegistration":true},"callHierarchy":{"dynamicRegistration":false},"publishDiagnostics":{"tagSupport":{"valueSet":[1,2]},"relatedInformation":true,"dataSupport":true},"implementation":{"linkSupport":true},"codeAction":{"dynamicRegistration":true,"resolveSupport":{"properties":["edit","command"]},"dataSupport":true,"isPreferredSupport":true,"codeActionLiteralSupport":{"codeActionKind":{"valueSet":["","quickfix","refactor","refactor.extract","refactor.inline","refactor.rewrite","source","source.organizeImports"]}}},"documentSymbol":{"dynamicRegistration":false,"symbolKind":{"valueSet":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]},"hierarchicalDocumentSymbolSupport":true},"completion":{"insertTextMode":1,"completionItemKind":{"valueSet":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]},"completionItem":{"labelDetailsSupport":true,"snippetSupport":true,"resolveSupport":{"properties":["documentation","additionalTextEdits","insertTextFormat","insertTextMode","command"]},"deprecatedSupport":true,"preselectSupport":true,"commitCharactersSupport":true,"insertReplaceSupport":true,"documentationFormat":["markdown","plaintext"],"insertTextModeSupport":{"valueSet":[1,2]},"tagSupport":{"valueSet":[1]}},"completionList":{"itemDefaults":["commitCharacters","editRange","insertTextFormat","insertTextMode","data"]},"contextSupport":true,"dynamicRegistration":false},"rangeFormatting":{"rangesSupport":true,"dynamicRegistration":true},"documentHighlight":{"dynamicRegistration":false},"formatting":{"dynamicRegistration":true},"hover":{"dynamicRegistration":true,"contentFormat":["markdown","plaintext"]},"rename":{"prepareSupport":true,"dynamicRegistration":true},"signatureHelp":{"signatureInformation":{"documentationFormat":["markdown","plaintext"],"activeParameterSupport":true,"parameterInformation":{"labelOffsetSupport":true}},"dynamicRegistration":false},"typeDefinition":{"linkSupport":true},"foldingRange":{"foldingRangeKind":{"valueSet":["comment","imports","region"]},"dynamicRegistration":false,"lineFoldingOnly":true,"foldingRange":{"collapsedText":true}},"codeLens":{"resolveSupport":{"properties":["command"]},"dynamicRegistration":false}},"window":{"showDocument":{"support":true},"workDoneProgress":true,"showMessage":{"messageActionItem":{"additionalPropertiesSupport":true}}}}},"id":1,"jsonrpc":"2.0","method":"initialize"}Content-Length: 52

{"params":{},"jsonrpc":"2.0","method":"initialized"}Content-Length: 280

{"params":{"settings":{"Lua":{"runtime":{"version":"LuaJIT"},"codeLens":{"enable":true},"hint":{"enable":true,"semicolon":"Disable"}},"workspace":{"library":"/usr/share/nvim/runtime"},"diagnostics":{"globals":["vim"]}}},"jsonrpc":"2.0","method":"workspace/didChangeConfiguration"}Content-Length: 27545

```

```json: server â†’ client
Content-Length: 55

{"jsonrpc":"2.0","method":"$/hello","params":["world"]}Content-Length: 172

{"jsonrpc":"2.0","method":"window/logMessage","params":{"message":"Log path: file:///tmp/lua-language-server-1000/instance.397R/log/file_home_qwjyh_dotfiles.log","type":4}}Content-Length: 1884

{"id":1,"jsonrpc":"2.0","result":{"capabilities":{"codeActionProvider":{"codeActionKinds":["","quickfix","refactor.rewrite","refactor.extract"],"resolveProvider":false},"codeLensProvider":{"resolveProvider":true},"colorProvider":true,"completionProvider":{"resolveProvider":true,"triggerCharacters":["\t","\n",".",":","(","'","\"","[",",","#","*","@","|","=","-","{"," ","+","?"]},"definitionProvider":true,"documentFormattingProvider":true,"documentHighlightProvider":true,"documentOnTypeFormattingProvider":{"firstTriggerCharacter":"\n"},"documentRangeFormattingProvider":true,"documentSymbolProvider":true,"executeCommandProvider":{"commands":["lua.removeSpace","lua.solve","lua.jsonToLua","lua.setConfig","lua.getConfig","lua.autoRequire"]},"foldingRangeProvider":true,"hoverProvider":true,"implementationProvider":true,"inlayHintProvider":{"resolveProvider":true},"offsetEncoding":"utf-16","referencesProvider":true,"renameProvider":{"prepareProvider":true},"semanticTokensProvider":{"full":true,"legend":{"tokenModifiers":["declaration","definition","readonly","static","deprecated","abstract","async","modification","documentation","defaultLibrary","global"],"tokenTypes":["namespace","type","class","enum","interface","struct","typeParameter","parameter","variable","property","enumMember","event","function","method","macro","keyword","modifier","comment","string","number","regexp","operator","decorator"]},"range":true},"signatureHelpProvider":{"triggerCharacters":["(",","]},"textDocumentSync":{"change":2,"openClose":true,"save":{"includeText":false}},"typeDefinitionProvider":true,"workspace":{"fileOperations":{"didRename":{"filters":[{"pattern":{"glob":"/home/qwjyh/dotfiles/**","options":{"ignoreCase":true}}}]}},"workspaceFolders":{"changeNotifications":true,"supported":true}},"workspaceSymbolProvider":true},"serverInfo":{"name":"sumneko.lua","version":"3.16.4"}}}Content-Length: 459

{"id":1,"jsonrpc":"2.0","method":"workspace/configuration","params":{"items":[{"scopeUri":"file:///home/qwjyh/dotfiles","section":"Lua"},{"scopeUri":"file:///home/qwjyh/dotfiles","section":"files.associations"},{"scopeUri":"file:///home/qwjyh/dotfiles","section":"files.exclude"},{"scopeUri":"file:///home/qwjyh/dotfiles","section":"editor.semanticHighlighting.enabled"},{"scopeUri":"file:///home/qwjyh/dotfiles","section":"editor.acceptSuggestionOnEnter"}]}}Content-Length: 459

```

